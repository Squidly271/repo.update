Menu="Docker:4"
Title="Community Repositories"
Cond="(pgrep('docker')!==false)"
---
<?
$plugin = "community.repositories";
$waiting = "<tr><td colspan='5'><br><center><img src='/webGui/images/spinner.gif'>&nbsp;<em>Please wait... retrieving repositories information!</em></center></td></tr>";
$line_color = $display['theme']=='black' ? '#202020' : '#E8E8E8';
?>
<style>
.searchSubmit{font-family:'FontAwesome';width:29px;height:26px;border:1px solid #dadada;border-radius:0px 4px 4px 0px;font-size:11px;position:relative;padding:0px 2px;background:#DADADA;border:none;cursor:pointer;}
table#templates_list tbody td.topRow{border-top:1px solid <?=$line_color?>;}
</style>
<script>
var URL = "/plugins/<?=$plugin?>/include/exec.php";
var imgRed = {src:"/plugins/<?=$plugin?>/images/red.png",title:'Click To Remove Container'};
var imgGreen = {src:"/plugins/<?=$plugin?>/images/green.png",title:'Click To Add Container'};
var last = $('input[name$="tabs"]').length;
<?if ($tabbed):?>
<?$shift = 'shift2';?>
$('.tabs').append("<span id='searchFilter' class='status vhshift' style='display:none'><a name='top'></a><input type='checkbox' id='selectBeta' onchange='toggleBeta();'>Show Beta <input type='text' id='searchBox' class='narrow' placeholder='Search' style='margin-right:0'><button class='searchSubmit' style='margin-right:10px' onclick='doSearch(true)'><i id='searchButton' class='fa fa-search fa-lg'></i></button><input type='button' value='Update Repositories' style='margin-right:2px' onclick='forceUpdate()'><input type='button' id='openclose' value='Show' onclick='openClose(this.value)'></span>");
for (var x=1; x<last; x++) $('#tab'+x).bind({click:function(){$('#searchFilter').hide();}});
$('#tab'+last).bind({click:function(){$('#searchFilter').show();}});
<?else:?>
<?$shift = 'shift';?>
$('div[id=title]').last().append("<span id='searchFilter' class='status vhshift'><a name='top'></a><input type='checkbox' id='selectBeta' onchange='toggleBeta();'>Show Beta <input type='text' id='searchBox' class='narrow' placeholder='Search' style='margin-right:0'><button class='searchSubmit' style='margin-right:10px' onclick='doSearch(true)'><i id='searchButton' class='fa fa-search fa-lg'></i></button><input type='button' value='Update Repositories' style='margin-right:2px' onclick='forceUpdate()'><input type='button' id='openclose' value='Show' onclick='openClose(this.value)'></span>");
<?endif;?>
$(function(){
  getContent(true);
  $('#searchBox').keyup(function(e) {if(e.which == 13){doSearch(false);}});
});

function toggleBeta() {
  var filter = $('#searchBox').val();
  var selectedBeta = $('#selectBeta').is(':checked');

  if ( selectedBeta ) {
    $('#helpShowBeta').prop('checked',true);
      document.getElementById('helpSelect1').innerHTML = "Deselect";
      document.getElementById('helpSelect2').innerHTML = "hide";

    }  else {
      $('#helpShowBeta').prop('checked',false);
      document.getElementById('helpSelect1').innerHTML = "Select";
      document.getElementById('helpSelect2').innerHTML = "show";
    }

    doSearch(false);
}


function helpToggleBeta() {
  var filter = $('#searchBox').val();
  var selectedBeta = $('#helpShowBeta').is(':checked');

  if ( selectedBeta ) {
    $('#selectBeta').prop('checked',true);
    }  else {
      $('#selectBeta').prop('checked',false);
    }

  toggleBeta();
}


function doSearch(button) {
  var filter = $('#searchBox').val();
  var selectedBeta = $('#selectBeta').is(':checked');

  if ($('#searchButton').hasClass('fa-search')) {
    if (filter) $('#searchButton').removeClass('fa-search').addClass('fa-remove');
  } else if (button) {
    if ($('#searchButton').hasClass('fa-remove')) $('#searchButton').removeClass('fa-remove').addClass('fa-search');
    filter = '';
    $('#searchBox').val('');
  } else if (!filter) return;

  $.post(URL,{action:'get_content',filter:filter,beta:selectedBeta},function(data) {
    if (data) $('#templates_content').html(data);
    $('#templates_list').trigger('update');
    $('.desc_readmore').readmore({maxHeight:50});
    if (!filter && $('#openclose').val()=='Show') $('#templates_list .expand-child td').hide();
  });
  
  if (filter) {
    $('#helpRepoName').hide();
    $('#helpShowLine').hide();
    $('#helpCart').hide();
  } else {
    $('#helpRepoName').show();
    $('#helpShowLine').show();
    $('#helpCart').show();
  }
}
function forceUpdate() {
  $('#templates_content').html("<?=$waiting?>");
  $.post(URL,{action:'force_update'},function(){getContent(false);});
}

function getContent(init) {
  var selectedBeta = $('#selectBeta').is(':checked');

  $.post(URL,{action:'get_content',beta:selectedBeta},function(data) {
    if (data) $('#templates_content').html(data);
    if (init) $('#templates_list').tablesorter({sortList:[[0,0]],headers:{1:{sorter:false},4:{sorter:false}}}); else $('#templates_list').trigger('update');
    $('.desc_readmore').readmore({maxHeight:50});
    $('#templates_list .expand-child td').hide();
    if (init) {
      $('#templates_list').on('click','.toggle',function() {
        $(this).closest('tr').nextUntil('tr:not(.expand-child)').find('td').toggle();
        return false;
      });
    }
  });
}
function toggleRepo(img, url) {
  $(img).load(function(){
    $.post(URL,{action:'toggle_repo', url:url},function(data) { 
      if(data.status){ if(data.status == 'enabled'){
        $(img).attr('title',imgRed.title).attr('src',imgRed.src);
      } else {
        $(img).attr('title',imgGreen.title).attr('src',imgGreen.src);
      }
    }},'json');
    $(img).unbind('load');
  });
  $(img).attr('src', '/plugins/<?=$plugin;?>/images/spinner.gif');
}
function openClose(action) {
  if (action=='Show') {
    $('#templates_list .expand-child td').show();
    $('#openclose').val('Hide');
    $('#helpShow').val('Hide');
    document.getElementById('helpShowText').innerHTML = "to only display the first container within a repository<br>";
  } else {
    $('#templates_list .expand-child td').hide();
    $('#openclose').val('Show');
    $('#helpShow').val('Show');
    document.getElementById('helpShowText').innerHTML = "to display all containers within all repositories<br>";
  }
}
</script>
> <span id='helpCart'>Click on <img src='/plugins/community.repositories/images/green.png' id='cartGreen' width=25> to add a repository to the repository list.  Click on 
<img src='/plugins/community.repositories/images/red.png' id='cartRed' width=25> to remove a repository from the repository list.<br></span>
> Click <input type=button value='Update Repositories' onclick='forceUpdate();'> to force an update of all repositories and containers<br>
> <span id='helpRepoName'>Click on the name of the repository to show / hide all of the containers within.<br></span>
> Click on the icon of the container to add the container (a new window will open).<br>
> <span id='helpShowLine'>Click <input id='helpShow' type=button value='Show' onclick=openClose(this.value)><span id='helpShowText'>to display all containers within all repositories.<br></span></span>
> <span id='helpSelect1'>Select</span> the <input id='helpShowBeta' type='checkbox' onchange='helpToggleBeta();'><strong>Show Beta</strong> check box to <span id='helpSelect2'>show</span> Beta Repositories in the main list / searches.
> <br><br>
<table id='templates_list' class='tablesorter <?=$shift?>'>
<thead><tr><th style='width:220px'>Repository</th><th style='width:64px'></th><th>Container</th><th>Author</th><th>Description</th></tr></thead>
<tbody id='templates_content'><?=$waiting?></tbody>
</table>
<a href="#top">Back To Top</a>
